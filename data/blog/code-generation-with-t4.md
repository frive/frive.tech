---
title: 'ILSpy, C# Syntax Analysis, and T4 Text Templates'
excerpt: 'Replacing ASNA Datagate pt. 1.34: Generate C# code from AVR'
coverImage: '/assets/blog/preview/cover.jpg'
date: '2019-07-19T05:35:07.322Z'
author:
  name: frive
ogImage:
  url: '/assets/blog/preview/cover.jpg'
---

Converting ~200 files manually from one language to another is grueling and monotonous. Imagine going to work every day to do the same thing for months – not something to look forward to, right? So I did what any lazy developer would do... automate!

![](https://imgs.xkcd.com/comics/automation.png)

I tried to avoid the reality depicted above when I decided to automate the [conversion process from `AVR` to `C#` using `XmlService`](/posts/xmlservice). I allotted a day to whip something working and called it a day after reaching a certain point. It was quick, dirty, but more importantly, it was working. I was satisfied with what I accomplished when the automation script can convert almost 90% of the code.

The process involved:
* [Decompilation](#decompilation)
* [Syntax Analysis](#syntax-analysis)
* [Code generation](#code-generation)


### Decompilation
The first step was to decompile the .NET assembly generated by the `AVR` code using [ILSpy](https://github.com/icsharpcode/ILSpy). This gave me a nice project containing all the converted code in `C#`. 

### Syntax Analysis
Next, we [analyze](https://docs.microsoft.com/en-us/dotnet/csharp/roslyn-sdk/get-started/syntax-analysis) the decompiled code and get the necessary information we need to convert it to its final state. The most critical data are the `RPG` program name, its parameters, and their respective types.

If you're using Visual Studio, I suggest installing the [Roslyn syntax visualizer](https://docs.microsoft.com/en-us/dotnet/csharp/roslyn-sdk/syntax-visualizer?tabs=csharp). This helped me a lot in getting all the information mentioned.

### Code Generation
The last thing is to generate the code we need based on the information from the analysis. I used [T4 Text Templates](https://docs.microsoft.com/en-us/visualstudio/modeling/code-generation-and-t4-text-templates?view=vs-2019) to generate two files for each converted `AVR` code. One is for the declarative representation of the `RPG` code in `C#`, and the second is for its usage. 

### Conclusion
This conversion script saved us 75% of the total estimate of the project, even if we have to do a 10% conversion manually. ✨

